/* IMAGE UPLOAD InitEditor() */
// Updated image upload handler for Base64 conversion
    images_upload_handler: function (blobInfo, success, failure) {
        try {
            const reader = new FileReader();

            reader.onload = function () {
                const base64Image = reader.result; // Base64 string
                success(base64Image); // Pass Base64 to TinyMCE
            };

            reader.onerror = function () {
                failure('Failed to read file and convert to Base64.');
            };

            reader.readAsDataURL(blobInfo.blob()); // Convert image to Base64
        } catch (error) {
            failure('An error occurred: ' + error.message);
        }
    },

    // Updated file picker callback
    file_picker_callback: function (callback, value, meta) {
        if (meta.filetype === 'image') {
            const input = document.createElement('input');
            input.setAttribute('type', 'file');
            input.setAttribute('accept', 'image/*');

            input.onchange = function () {
                const file = this.files[0];
                const reader = new FileReader();

                reader.onload = function () {
                    const base64Image = reader.result; // Base64 string
                    callback(base64Image, { alt: file.name }); // Pass Base64 to TinyMCE
                };

                reader.onerror = function () {
                    console.error('Failed to read file and convert to Base64.');
                };

                reader.readAsDataURL(file); // Convert image to Base64
            };

            input.click();
        }
    }
/* END OF IT */

/* PHP MAILER */
$title = $_POST["title"];
    $content = $_POST["content"];

    // Autoload files if using Composer
    require 'vendor/autoload.php';

    $mail = new PHPMailer(true);

    try {
        // Server settings
        $mail->isSMTP();                                            // Send using SMTP
        $mail->Host       = 'smtp.gmail.com';                     // Set the SMTP server
        $mail->SMTPAuth   = true;                                   // Enable SMTP authentication
        $mail->Username   = 'yako.mailer@gmail.com';               // SMTP username
        $mail->Password   = 'fqcy btct skpv wlxx';                  // SMTP password
        $mail->SMTPSecure = PHPMailer::ENCRYPTION_STARTTLS;         // Enable TLS encryption
        $mail->Port       = 587;                                   // TCP port to connect to

        // Recipients
        $mail->setFrom('yako.mailer@gmail.com', 'Angaza Home Church');
        $mail->addAddress('georgekimagut@proton.me', 'George Kimagut'); // Add a recipient

        // Content
        $mail->isHTML(true);                                       // Set email format to HTML
        $mail->Subject = $title;
        $mail->Body    = $content;
        $mail->AltBody = $content;

        $mail->send();
        echo "1";
    } catch (Exception $e) {
        echo "Message could not be sent. Mailer Error: {$mail->ErrorInfo}";
    }

/* VIEW NEWSLETTER WITH ALL DETAILS */
$get_newsletters = $conn->query("select * from newsletters order by newsletter_id DESC");
    $count = mysqli_num_rows($get_newsletters);

    if ($count < 1) {
        $result = 2;
        echo json_encode($result);
    } else {
        $result = []; // Initialize result array
        while ($newsletter = mysqli_fetch_assoc($get_newsletters)) {
            // Extract newsletter attachments as an array
            $newsletter_attachments = explode(",", trim($newsletter['newsletter_attachments'], "{}"));

            // Prepare each newsletter with attachments
            $result[] = [
                'id' => $newsletter['newsletter_id'],
                'title' => $newsletter['newsletter_title'],
                'content' => $newsletter['newsletter_content'],
                'status' => $newsletter['newsletter_status'],
                'date' => $newsletter['created_at'],
                'attachments' => $newsletter_attachments // Add attachments array
            ];
        }
        echo json_encode($result); // Send result as JSON
    }

/* home about */
<p class="text-white four-vh">WHO ARE WE?</p>
                    <h4 class="text-white">we believe everyone has a unique purpose and calling.</h4>
                    <p class="text-white">Our mission is to help you discover your SHAPE—your Spiritual gifts, Heart, Abilities, Personality, and Experience—so you can live a fulfilling and impactful life.</p>

/* home programs */
<div class="card">
                    <div class="text-center">
                        <i class="fa-solid fa-shapes"></i>
                    </div>
                    <div class="card-body">
                        <h5 class="card-title text-primary">SHAPE</h5>
                        <p class="card-text">Identify your unique Spiritual gifts, Heart, Abilities, Personality, and Experience.</p>
                    </div>
                </div>
                <div class="card">
                    <div class="text-center">
                        <i class="fa-solid fa-random"></i>
                    </div>
                    <div class="card-body">
                        <h5 class="card-title text-primary">FLEXI</h5>
                        <p class="card-text">Learn to cultivate a FLEXI mindset, focusing on Fire or Spirit, Leadership Community Influence.</p>
                    </div>
                </div>
                <div class="card">
                    <div class="text-center">
                        <i class="fa-solid fa-tools"></i>
                    </div>
                    <div class="card-body">
                        <h5 class="card-title text-primary">Workshops</h5>
                        <p class="card-text">Through APY Crafts and Pepali Defined, engage in hands-on projects that foster creativity.</p>
                    </div>
                </div>
                <div class="card">
                    <div class="text-center">
                        <i class="fa-solid fa-hands-helping"></i>
                    </div>
                    <div class="card-body">
                        <h5 class="card-title text-primary">Discipleships</h5>
                        <p class="card-text">Our discipleship model emphasizes four critical relationships.</p>
                    </div>
                </div>

/* about vision */
To reconnect individuals to their original identity in Christ. We strive to raise five hundred thousand leaders who are passionate, purpose-driven, and impactful in their communities.

/* mission & approach */
<h4 class="text-primary four-vh">OUR <span class="text-black">MISSION</span></h4>
<p class="text-third</span>">Our Mission is two-fold: </p>
<p class="text-secondary col-10 two-vh">1. Help individuals understand their <span class="fw-bold text-primary">SHAPE— </span>Spiritual gifts, Heart, Abilities, Personality,
and Experience—so they can fulfill their unique calling.</p>
<p class="text-secondary col-10 two-vh">2. Foster a <span class="fw-bold text-primary">FLEXI</span> mindset—growing the Fire of the Spirit, Leadership of Self,
Entrepreneurial X-factor, and Impactful community influence.</p>

<h4 class="text-primary four-vh">OUR <span class="text-black">APPROACH</span></h4>
<p class="text-third</span>">We provide structured programs that combine personal development and
creative expression through our initiatives—APY Crafts and Pepali Defined. Our model
encourages discipleship, fostering growth in individuals who then inspire others.</p>

/* home offer */
<p class="text-white four-vh">WE OFFER</p>
<h4 class="text-white">Personal Development Programs</h4>
<p class="text-white">Join our workshops and coaching sessions to grow in your faith and leadership skills.</p>
<h4 class="text-white">Creative Expression</h4>
<p class="text-white">Explore APY Crafts and Pepali Defined, where creativity meets   purpose through crafts and productivity tools.</p>
<h4 class="text-white">Community Support</h4>
<p class="text-white">Connect with like-minded individuals through our coaching
    relationships—find a coach, a peer, and become an apprentice.</p>

/* top values */
<div class="col-3 value bg-gradient">
<div class="inner-value">
<i class="fa-solid fa-person-praying text-white"></i>
<p class="text-white">PRAYER</p>
</div>
</div>
<div class="col-3 value bg-gradient">
<div class="inner-value">
<i class="fa-solid fa-scroll text-white"></i>
<p class="text-white">PROPHECY</p>
</div>
</div>
<div class="col-3 value bg-gradient">
<div class="inner-value">
<i class="fa-solid fa-handshake text-white"></i>
<p class="text-white">PARTNERSHIP</p>
</div>
</div>

/* bottom values */
<div class="col-4 card four-vh">
  <div class="icon-holder">
    <i class="fa-solid fa-person-praying"></i>
  </div>
      <p class="two-vh text-third fw-bold">PRAYER</p>
      <p class="text-muted two-vh">Our foundation is built on a strong connection with God.</p>
  </div>
  <div class="col-4 card four-vh">
    <div class="icon-holder">
        <i class="fa-solid fa-scroll"></i>
      </div>
          <p class="two-vh text-third fw-bold">PROPHECY</p>
          <p class="text-muted two-vh">We align our individual purposes with God's greater plan for reconciliation.</p>
          </div>
  <div class="col-4 card four-vh">
    <div class="icon-holder">
      <i class="fa-solid fa-handshake"></i>
    </div>
        <p class="two-vh text-third fw-bold">PARTNERSHIP</p>
        <p class="text-muted two-vh">Building authentic relationships within the body of Christ to support and uplift one another.</p>
  </div>